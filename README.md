# Тестовое задание DevOps для Effective Mobile

## Задание

Написать скрипт на bash для мониторинга процесса test в среде linux. Скрипт должен отвечать следующим требованиям:

1. Запускаться при запуске системы (предпочтительно написать юнит systemd в дополнение к скрипту)
2. Отрабатывать каждую минуту
3. Если процесс запущен, то стучаться (по https) на <https://test.com/monitoring/test/api>
4. Если процесс был перезапущен, писать в лог `/var/log/monitoring.log`
(если процесс не запущен, то ничего не делать)
5. Если сервер мониторинга не доступен, так же писать в лог.

## Реализация

### Скрипт

Основной скрипт `testmon.sh`

Для удобства, имя процесса, URL сервера мониторинга и имя (basename) лог-файла вынесены в перемнные.

Алгоритм работы:

1. Проверяет запущен ли процесс "test". Если процесс не запущен, то ничего не делает.
2. Если запущен, то стучится на сервер мониторинга по <https://test.com/monitoring/test/api>
3. Если сервер мониторинга не доступен или возвращает код 400 и выше, пишет в лог: `/var/log/monitoring.log`
4. Проверяет был ли процесс перезапущен путём сравнения pid работающего процесса и сохраненный в .pid файле.
5. Если процесс был перезапущен, пишет в лог: `/var/log/monitoring.log`

### Юнит для systemd (TODO)

Запуск скрипта при старте системы реализован стандартными средствами systemd. Скрипт запускается после запуска всех прочих процессов на заданном уровне запуска.

- Удаляет .pid файл из временной папки, если он существует (остался от предыдущих сессий)
- Запускает основной скрипт

### Скрипт инициализации (TODO)

Скрипт инициализации:

- настраивает `cron` для запуска основного скрипта каждую минуту.
- копирует в целевое расположение юнит systemd.
